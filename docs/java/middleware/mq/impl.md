# impl

## p2p or pub/sub

### p2p

点对点模式: 消息被发送到一个特定的队列，可以有多个消费者

- 一对一: 尽管有多个消费者，但是一条消息只能被一个消费者处理
- 负载均衡: 生产者消息发送太快，可以增加消费者的数量
- 消息丢失：一旦消息被ack,消息从队列中移除
- 适用场景：任务分发，一个订单只会被处理一次，防止订单重复

### pub/sub

发布/订阅模型：消息被发送到一个topic

- 一对多： 一条消息会发送给所有订阅该topic的订阅者
- 独立解耦： 发布者不知道有多少个订阅者，订阅者每个人有自己的副本
- 适用场景： 一个订单的消息,同时扣减库存，分析系统记录日志

## ack

- producer: 确认消息发送到mq并持久化 ack
- consumer：确认业务处理完mq才删除或者标记消息

## peresistence

- 消息不能只存在内存，必须落盘

## retry

- 消息消费失败时，应该支持自动重试（死信队列）

## ordered message

- 顺序消息：可以保证消息的先进先出

## message rewind

- 消息回溯：当业务逻辑错误时，mq允许消费者将offset重置到过去某个时间点，重新消费历史消息

## message routing

- 消息路由：可以通过head or tag 路由消息

## high availability

- HA: 集群，主从
